"use strict";(self.webpackChunk_quiq_=self.webpackChunk_quiq_||[]).push([[890],{56573:(t,e,n)=>{n.d(e,{"RUNTIME_ENVIRONMENT":()=>w,"default":()=>S});var i=n(43031),o=n(11589),r=n(43345),a=n(48225),s=n(26169),c=n(96147),h=n(33815),u=n(23189),l=n(73645),p=n(70878),d=n(28572),g=n(21554),_=n(67200),f=n(13819);function y(){return y=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},y.apply(this,arguments)}function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(o=i.key,r=void 0,"symbol"==typeof(r=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(o,"string"))?r:String(r)),i)}var o,r}function L(t,e,n){return e&&b(t.prototype,e),n&&b(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var v,w,I=n(4147).version;!function(t){t.FATAL="fatal",t.GRACEFULLY="gracefully"}(v||(v={})),function(t){t.SDK="sdk",t.APP_IFRAME="app-iframe",t.APP_WINDOW="app-window"}(w||(w={}));var A=function(){var t=e.prototype;function e(){this._runtimeEnvironment=void 0,this._cache=void 0,this._tenantId=void 0,this._pageOptions=void 0,this._chatterboxConfiguration=void 0,this._deepLinkWhitelist=void 0,this._internalOptions=void 0,this._contactPoint=void 0,this._persistedData=void 0,this._currentLocation=void 0,this._parentWindowLocation=void 0,this._tenantLocation=void 0,this._cdnLocation=void 0,this._conversationStarter=void 0,this._currentLocation=(0,i.bM)(),this._cache=new E,this._conversationStarter=new _.Z,r.HD.isNotEmpty(window.__serializedQuiqSettings)&&(this.deserialize(window.__serializedQuiqSettings),this.processInternalOptions())}return t.processInternalOptions=function(){if(r.Kn.isNotEmpty(this._internalOptions)){var t=this._internalOptions,e=t.captureRequests,n=t.captureWebsockets;if(e){window.__quiq__capturedRequests=[];var i=window.fetch,o=window.XMLHttpRequest.prototype.open;window.XMLHttpRequest.prototype.open=function(t,e){return window.__quiq__capturedRequests.push({method:t,url:e}),o.call(this,t,e)},window.fetch=function(t,e){var n=e.method||"GET";return window.__quiq__capturedRequests.push({method:n,url:t}),i.call(this,t,e)}}if(n){window.__quiq__ws={instances:[],get connectedCount(){return this.instances.filter((function(t){return 1===t.readyState})).length}};var a=window.WebSocket;window.WebSocket=function(t,e){var n=new a(t,e);return window.__quiq__ws.instances.push(n),n}}}},t.warning=function(t){c.ZP.logException(t,{level:f.z.Warning,context:this.getMetadataContext(),tags:y(y({},this.getMetadataTags()),{},{severity:c.ym.WARNING,repository:c.Pf.WEBCHAT,category:c.Gl.SETTINGS})}),console.warn(t)},t.error=function(t,e,n){if(c.ZP.logException(e,{level:f.z.Error,context:this.getMetadataContext(),tags:y(y({},this.getMetadataTags()),{},{severity:c.ym.MEDIUM,repository:c.Pf.WEBCHAT,category:c.Gl.SETTINGS},n)}),t!==v.GRACEFULLY)throw e;console.error(e)},t.getMetadataContext=function(){return{quiqSettings_PageOptions:this._pageOptions,quiqSettings_ChatterboxConfiguration:this._chatterboxConfiguration,quiqSettings_DeepLinkWhitelist:this._deepLinkWhitelist,quiqSettings_InternalOptions:this._internalOptions,quiqSettings_PersistedData:this._persistedData}},t.getMetadataTags=function(){return{contactPoint:this._contactPoint,currentHREF:r.Kn.isNotEmpty(this._currentLocation)?this._currentLocation.href:"",clientHREF:r.Kn.isNotEmpty(this._parentWindowLocation)?this._parentWindowLocation.href:"",tenantHREF:r.Kn.isNotEmpty(this._tenantLocation)?this._tenantLocation.href:""}},t.initialize=function(t,e,n,h){(0,r.J2)(e)&&this.error(v.FATAL,new Error("Unable to initialize the QuiqSettings object for the '"+t+"'. The QuiqObject is null, undefined, or empty."),{severity:c.ym.CRITICAL,subcategory:c.Gl.INITIALIZATION}),((0,r.J2)(e._bootloader)||(0,r.rf)(e._bootloader.cdn))&&this.error(v.FATAL,new Error("Unable to initialize the QuiqSettings object for the '"+t+"'. The QuiqObject does not have a valid '_bootloader' settings object. The SDK can no longer be used directly and must use the bootloader."),{severity:c.ym.CRITICAL,subcategory:c.Gl.INITIALIZATION}),(0,r.Bn)(h)&&this.error(v.FATAL,new Error("Unable to initialize the QuiqSettings object for the '"+t+"'. The parent window's location object is null, undefined, or empty."),{severity:c.ym.CRITICAL,subcategory:c.Gl.INITIALIZATION}),this._runtimeEnvironment=t,(0,s.P)(e);var u=(0,d.e)(e);this._tenantId=n.tenantId,this._contactPoint=e.contactPoint,this._persistedData=e.persistedData,this._pageOptions=u,this._deepLinkWhitelist=e.deepLink,this._internalOptions=e._internal,this._chatterboxConfiguration=(0,o.ES)(n),this._parentWindowLocation=h,this._tenantLocation=r.HD.isNotEmpty(e.host)?(0,i.ak)(e.host):(0,i.ak)((0,a.kd)()),this._cdnLocation=r.HD.isNotEmpty(e._bootloader.cdn)&&-1!==e._bootloader.cdn.toLowerCase().indexOf("quiq.dev:3100")?(0,i.ak)(window.quiqCdnOrigin):(0,i.ak)(e._bootloader.cdn),r.Kn.isNotEmpty(e._conversationStarter)&&r.HD.isNotEmpty(e._conversationStarter.displayMode)&&this._conversationStarter.set({isControllingWebChat:!0,referrerUrl:e._conversationStarter.referrerUrl,displayMode:e._conversationStarter.displayMode,hideForgetMeButton:!0===e._conversationStarter.hideForgetMeButton}),this._cache.clear()},t.serialize=function(){return JSON.stringify({tenantId:this._tenantId,contactPoint:this._contactPoint,persistedData:this._persistedData,pageOptions:this._pageOptions,deepLinkWhitelist:this._deepLinkWhitelist,internalOptions:this._internalOptions,chatterboxConfiguration:this._chatterboxConfiguration,parentURL:r.Kn.isNotEmpty(this._parentWindowLocation)?this._parentWindowLocation.href:void 0,tenantURL:this._tenantLocation.href,cdnLocation:this._cdnLocation.href,conversationStarter:this._conversationStarter.json()})},t.deserialize=function(t){var e;try{e=JSON.parse(t)}catch(t){t.message="Unable to deserialize the QuiqSettings JSON string. "+t.message,this.error(v.FATAL,t,{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION})}((0,r.Bn)(e)||"object"!=typeof e)&&this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The deserialized value is null, undefined, empty, or not an object."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),((0,r.Bn)(e.contactPoint)||"string"!=typeof e.contactPoint)&&this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The property 'contactPoint' is missing from the deserialized string."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),"object"==typeof e.pageOptions&&null!==e.pageOptions||this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The property 'pageConfiguration' is missing from the deserialized object."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),(0,r.Bn)(e.chatterboxConfiguration)&&this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The property 'chatterboxConfiguration' is missing from the deserialized object."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),(0,r.Bn)(e.parentURL)&&this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The property 'parentURL' is missing from the deserialized object."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),(0,r.Bn)(e.tenantURL)&&this.error(v.FATAL,new Error("Unable to deserialize the QuiqSettings JSON string. The property 'tenantURL' is missing from the deserialized object."),{severity:c.ym.CRITICAL,subcategory:c.Gl.DESERIALIZATION}),this._runtimeEnvironment=window===window.parent?w.APP_WINDOW:w.APP_IFRAME,this._tenantId=e.tenantId,this._contactPoint=e.contactPoint,this._persistedData=e.persistedData,this._pageOptions=e.pageOptions,this._deepLinkWhitelist=e.deepLinkWhitelist,this._internalOptions=e.internalOptions,this._chatterboxConfiguration=e.chatterboxConfiguration,this._conversationStarter.set(e.conversationStarter),this._parentWindowLocation=(0,i.ak)(e.parentURL,{parseSearch:{preventDefaultValue:!0}}),this._tenantLocation=(0,i.ak)(e.tenantURL,{parseSearch:{preventDefaultValue:!0}}),this._cdnLocation=(0,i.ak)(e.cdnLocation,{parseSearch:{preventDefaultValue:!0}}),this._cache.clear()},L(e,[{key:"runtimeEnvironment",get:function(){return this._runtimeEnvironment}},{key:"isUsingChildAppIFrame",get:function(){return this.platform===l.Z.CHAT||this.platform===l.Z.SMS||this.platform===l.Z.APPLE_BUSINESS_CHAT}},{key:"options",get:function(){return(0,r.Bn)(this._cache.options)&&((0,r.J2)(this._pageOptions)&&this.warning("Warning getting the QuiqSettings options. The page configuration has not been set. This may be valid since a customer is not required to set options at the page-level. Or this could be an error."),(0,r.Bn)(this._parentWindowLocation)&&this.warning("Warning getting the QuiqSettings options. The parent window location has not been set. This will prevent the deep-link overrides from being applied."),(0,r.Bn)(this._chatterboxConfiguration)&&this.error(v.GRACEFULLY,new Error("Error getting the QuiqSettings options. The chatterbox configuration has not been set. Failing gracefully and allowing the code to proceed with the defaults."),{severity:c.ym.HIGH}),this._cache.options=(0,d.R)(this._chatterboxConfiguration,this._pageOptions,this._parentWindowLocation,this._deepLinkWhitelist)),this._cache.options}},{key:"pageOptions",get:function(){return QuiqUtils._.cloneDeep(this._pageOptions)}},{key:"configuration",get:function(){return QuiqUtils._.cloneDeep(this._chatterboxConfiguration)}},{key:"tenantOrigin",get:function(){return(0,r.Bn)(this._tenantLocation)&&this.error(v.FATAL,new Error("Unable to get the tenant's origin. The tenant location object has not been set."),{severity:c.ym.CRITICAL}),this._tenantLocation.origin}},{key:"cdnOrigin",get:function(){return(0,r.Bn)(this._cdnLocation)&&this.error(v.FATAL,new Error("Unable to get the CDN's origin. The CDN location object has not been set."),{severity:c.ym.CRITICAL}),this._cdnLocation.origin}},{key:"childFrameOrigin",get:function(){return(0,r.Bn)(this._tenantLocation)&&this.error(v.FATAL,new Error("Unable to get the CDN's origin. The CDN location object has not been set."),{severity:c.ym.CRITICAL}),this._tenantLocation.origin}},{key:"clientOrigin",get:function(){return(0,r.Bn)(this._parentWindowLocation)&&this.error(v.FATAL,new Error("Unable to get the client origin. The parent window location object has not been set."),{severity:c.ym.CRITICAL}),this._parentWindowLocation.origin}},{key:"clientLocation",get:function(){return QuiqUtils._.cloneDeep(this._parentWindowLocation)||{}}},{key:"currentLocation",get:function(){return QuiqUtils._.cloneDeep(this._currentLocation)||{}}},{key:"referrerLocation",get:function(){var t=this.clientLocation;return this._conversationStarter.isControllingWebChat&&r.Kn.isNotEmpty(this._conversationStarter.referrerLocation)&&(t=this._conversationStarter.referrerLocation),t}},{key:"contactPoint",get:function(){return this._contactPoint}},{key:"tenantId",get:function(){return this._tenantId}},{key:"tenantLabel",get:function(){if((0,r.Bn)(this._tenantLocation))throw new Error("Unable to get the tenant. The tenant's location object is null, undefined, or an empty object");var t=this._tenantLocation.hostname.indexOf(".");return this._tenantLocation.hostname.substring(0,t)}},{key:"platform",get:function(){var t,e=this.options,n=this.configuration,i=n.enableMobileChat,o=n.mobileInfo,s=n.enableChatAsMobileFallback,c=l.Z.NONE,h=p.Z.isEnabled,u=(0,a.V3)()&&r.HD.isNotEmpty(null===(t=o.AppleMessages)||void 0===t?void 0:t.id),d=r.HD.isNotEmpty(o.phoneNumber)||r.HD.isNotEmpty(e.mobileNumber);return!0===e.forceWebChat?c=l.Z.CHAT:(0,a.Em)()?i&&!s?c=l.Z.CHAT:h?c=l.Z.GOOGLE_BUSINESS_MESSAGING:u?c=l.Z.APPLE_BUSINESS_CHAT:(d||i&&s)&&(c=l.Z.CHAT):(0,a.tq)()?i&&!s?c=l.Z.CHAT:h?c=l.Z.GOOGLE_BUSINESS_MESSAGING:u?c=l.Z.APPLE_BUSINESS_CHAT:d?c=l.Z.SMS:i&&s&&(c=l.Z.CHAT):c=l.Z.CHAT,c}},{key:"persistedData",get:function(){return QuiqUtils._.cloneDeep(this._persistedData)},set:function(t){this._persistedData=t,this._cache.clear()}},{key:"webchatURL",get:function(){(0,r.Bn)(this._tenantLocation)&&this.error(v.FATAL,new Error("Unable to get the webchat url. The CDN location object has not been set."),{severity:c.ym.CRITICAL});var t=(0,a.Tz)()?"app/webchat/webchat.html":"app/webchat/webchat-"+I+"-b70c9a9e.html";return this._tenantLocation.protocol+"//"+this._tenantLocation.host+"/"+t}},{key:"conversationStarter",get:function(){return this._conversationStarter}},{key:"showChatCloseButton",get:function(){return this.options.displayMode===g.Z.DOCKED||this.options.displayMode===g.Z.EITHER||this.conversationStarter.isControllingWebChat&&this.conversationStarter.displayMode===g.Z.UNDOCKED}},{key:"showForgetMeButton",get:function(){return r.Kn.isNotEmpty(this._chatterboxConfiguration)&&this._chatterboxConfiguration.forgetMeEnabled&&!this.conversationStarter.hideForgetMeButton&&!(0,a.oE)()&&(0,u.lD)()!==h.ey.TEMPORARY}}]),e}(),E=function(){function t(){this._cachedOptions=void 0,this._cachedOptions=null}return t.prototype.clear=function(){this._cachedOptions=null},L(t,[{key:"options",get:function(){return this._cachedOptions},set:function(t){if((0,r.Bn)(t))throw new Error("Unable to cache the QuiqOptions object in QuiqSettings memory. The object is null, undefined, or empty.");this._cachedOptions=t}}]),t}();const S=new A}}]);
//# sourceMappingURL=common-webchat-1.8.114-b70c9a9e.js.map